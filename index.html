<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PumpWolf Dashboard â€” Neon Cyber</title>

  <meta name="description" content="PumpWolf Dashboard â€” Cyber Meme Utility tracking Solana gems in real time." />
  <meta property="og:title" content="ðŸº PumpWolf Dashboard â€” Live Token Feed" />
  <meta property="og:description" content="Track early Solana gems with PumpWolf HQ â€” powered by Moralis API (proxy)." />
  <meta property="og:image" content="https://raw.githubusercontent.com/3disutisna-afk/pumpwolf/main/assets/pumpwolf_banner.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#030406; --card:#071018; --neon:#00f0ff; --accent:#8a2be2; --muted:#9bb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:radial-gradient(circle at 10% 10%,#02030a 0%,var(--bg) 60%);color:#dff}
    header{padding:22px 20px;display:flex;align-items:center;gap:18px;border-bottom:1px solid rgba(0,255,255,0.03)}
    header .logo{width:64px;height:64px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;background:radial-gradient(circle at 30% 30%,#002,#012233);box-shadow:0 0 24px rgba(0,240,255,0.08)}
    header h1{margin:0;font-size:1.25rem;color:var(--neon)}
    .layout{display:flex;gap:20px;padding:20px;align-items:flex-start}
    .col-left{width:320px;min-width:260px}.col-main{flex:1}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.015));border:1px solid rgba(0,240,255,0.06);border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
    .muted{color:var(--muted)}
    .btn{background:linear-gradient(90deg,var(--neon),var(--accent));border:none;color:#001;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;text-decoration:none;display:inline-block}
    .small{padding:6px 10px;font-size:0.9rem}
    .tiny{font-size:0.85rem;color:var(--muted)}
    .token-list{display:flex;flex-direction:column;gap:12px;max-height:65vh;overflow:auto;padding-right:6px}
    .token{display:flex;gap:12px;align-items:center;border-radius:10px;padding:10px;background:linear-gradient(90deg,rgba(0,0,0,0.14),rgba(0,0,0,0.06));border:1px solid rgba(0,240,255,0.03)}
    .token:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(0,240,255,0.06)}
    footer{padding:14px 28px;color:var(--muted);font-size:0.9rem;text-align:center}
    .pw-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:9999}
    .pw-modal.open{display:flex}
    /* fallback banner */
    .pw-fallback {
      display:none;
      position:fixed;
      inset:12px 12px auto 12px;
      z-index:99999;
      background: linear-gradient(90deg, rgba(6,8,16,0.98), rgba(3,5,12,0.98));
      color:#dff;
      border:1px solid rgba(0,240,255,0.08);
      padding:12px 14px;
      border-radius:12px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.6);
      max-width:calc(100% - 40px);
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      font-family: Inter, system-ui, sans-serif;
    }
    .pw-fallback .left { display:flex; gap:10px; align-items:center; max-width:70%; }
    .pw-fallback .title { font-weight:700; color:var(--neon); font-size:0.98rem }
    .pw-fallback .desc { font-size:0.9rem; color:var(--muted); margin-top:4px }
    .pw-fallback .actions { display:flex; gap:8px; align-items:center }
    .pw-fallback .btn { background:linear-gradient(90deg,var(--neon),var(--accent)); color:#001; padding:8px 10px; border-radius:10px; font-weight:700; text-decoration:none; border:none; cursor:pointer; }
    .pw-fallback .btn.secondary { background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--muted); padding:8px 10px; }
    @media(max-width:720px){
      .pw-fallback { flex-direction:column; align-items:flex-start; gap:8px; left:12px; right:12px; }
      .pw-fallback .left { max-width:100%; }
      .pw-fallback .actions { width:100%; justify-content:space-between; }
    }
  </style>
</head>
<body>

<!-- fallback banner (will be created/shown by script if vercel probe fails) -->
<div id="pwFallback" class="pw-fallback" role="alert" aria-live="polite" style="display:none;">
  <div class="left">
    <div style="width:12px;height:12px;border-radius:50%;background:#ff6b6b;margin-right:8px"></div>
    <div>
      <div class="title">Mode statis: fitur server tidak aktif di GitHub Pages</div>
      <div class="desc">Proxy/API backend (Vercel) tidak terjangkau dari halaman ini. Untuk pengalaman penuh, buka versi lengkap.</div>
    </div>
  </div>
  <div class="actions">
    <a id="openVercel" class="btn" href="https://pumpwolf.vercel.app/" target="_blank" rel="noopener">Buka versi penuh</a>
    <button id="stayBtn" class="btn secondary" type="button">Tetap di sini</button>
    <div style="display:flex;align-items:center"><span class="count" id="redirectCountdown">â†ª otomatis pindah dalam 8s</span></div>
  </div>
</div>

<header>
  <div class="logo">PW</div>
  <div>
    <h1>PumpWolf Dashboard</h1>
    <div class="muted">Live feed â€” only Level 2 &amp; Level 3 tokens</div>
  </div>
</header>

<div class="layout">
  <aside class="col-left">
    <div class="card">
      <div class="muted">Connected API</div>
      <div style="margin-top:6px"><b id="api-status" style="color:var(--neon)">Proxy: ready</b></div>
      <div style="margin-top:8px" class="muted">Last update: <span id="last-update">â€”</span></div>
    </div>

    <div class="card">
      <div class="muted">Filters</div>
      <div style="height:8px"></div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn small" id="refreshBtn">Refresh</button>
        <button class="btn small" id="pauseBtn">Pause</button>
      </div>
      <div style="height:10px"></div>
      <div class="muted">Info</div>
      <div class="tiny" style="margin-top:8px">Dashboard mengambil endpoint Pump.fun via Moralis melalui proxy Vercel. Di GitHub Pages proxy tidak tersedia.</div>
    </div>
  </aside>

  <main class="col-main">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px">
        <div><b style="color:var(--neon)">Live Tokens</b> <span class="muted"> â€” showing tokens that passed filters</span></div>
        <div class="muted">Auto refresh: <span id="interval-label">60s</span></div>
      </div>
      <div id="tokenContainer" class="token-list">
        <!-- token cards injected here -->
      </div>
    </div>
  </main>
</div>

<footer>Â© 2025 PumpWolf â€” The Cyber Pack â€¢ Dashboard demo</footer>

<script>
/*
  Smart proxy URL selector
  - Jika di Vercel (domain berakhiran vercel.app atau hostname === 'pumpwolf.vercel.app'),
    gunakan path RELATIF '/api/proxy/...' (agar memakai function serverless di same origin).
  - Jika bukan Vercel (mis. GitHub Pages), gunakan ABSOLUTE URL ke Vercel deploy kita.
  - Pastikan tidak menaruh API key di client.
*/

(function(){
  // --- CONFIG ---
  const VERCEL_HOST = 'pumpwolf.vercel.app'; // ganti jika domain vercel-mu berbeda
  const VERCEL_BASE = `https://${VERCEL_HOST}`; // full base URL to vercel site
  const PROXY_PATH = '/api/proxy'; // path used on Vercel

  // runtime decide base
  const onVercel = (location.hostname === VERCEL_HOST) || location.hostname.endsWith('.vercel.app');
  // If the page is served ON vercel, use relative path so function resolves in same origin.
  // Else (GitHub Pages) use absolute vercel URL so browser calls Vercel serverless.
  const PROXY_BASE = onVercel ? '' : VERCEL_BASE;

  // Endpoints (use PROXY_BASE + PROXY_PATH)
  const ENDPOINT = `${PROXY_BASE}${PROXY_PATH}/token/mainnet/exchange/pumpfun/new?limit=100`;
  const FEATURE_PRICE_URL = (addr) => `${PROXY_BASE}${PROXY_PATH}/token/mainnet/${encodeURIComponent(addr)}/price`;
  // featured token address (set AFTER peluncuran token)
  const FEATURED_TOKEN_ADDRESS = "YOUR_TOKEN_ADDRESS"; // replace when ready

  // other config
  const POLL_INTERVAL = 60000;
  const MIN_LIQUIDITY = 5000;

  // expose for other code in page
  window.PW_CONFIG = {
    ENDPOINT,
    FEATURE_PRICE_URL,
    FEATURED_TOKEN_ADDRESS,
    POLL_INTERVAL,
    MIN_LIQUIDITY,
    ON_VERCEL: onVercel,
    VERCEL_BASE
  };

  // optional debug log to console so kita tahu apa yang dipakai
  console.info('[PW] proxy base:', PROXY_BASE || '(relative on vercel)');
})();
</script>
async function fetchTokens(){
  apiStatusEl.textContent = 'Fetching...';
  debugLog("Starting fetch to " + ENDPOINT);
  try {
    const res = await fetch(ENDPOINT, { headers: { "accept": "application/json" }});
    debugLog("Response status: " + res.status, { ok: res.ok, headers: (() => {
      const o = {}; for(const p of res.headers.keys()) o[p] = res.headers.get(p); return o;
    })()});

    if(!res.ok){
      apiStatusEl.textContent = `Proxy: error ${res.status}`;
      tokenContainer.innerHTML = `<div class="tiny">Proxy returned ${res.status} â€” cek log</div>`;
      lastUpdateEl.textContent = new Date().toLocaleTimeString();
      const text = await res.text().catch(()=>"[no body]");
      debugLog("Non-ok body:", text);
      return;
    }

    const dataText = await res.text();
    debugLog("Raw body received (first 2k chars):", dataText.slice ? dataText.slice(0, 2000) : dataText);
    let data;
    try {
      data = JSON.parse(dataText);
    } catch(parseErr){
      debugLog("JSON parse error", { error: String(parseErr), raw: dataText.slice ? dataText.slice(0,2000) : dataText });
      apiStatusEl.textContent = 'Proxy: bad-json';
      tokenContainer.innerHTML = `<div class="tiny">Response bukan JSON valid â€” cek debug panel / console</div>`;
      lastUpdateEl.textContent = new Date().toLocaleTimeString();
      return;
    }

    debugLog("Parsed JSON", data);
    const items = Array.isArray(data.result) ? data.result : (Array.isArray(data) ? data : []);
    debugLog("Items length", items.length);

    // filter (temporer: MIN_LIQUIDITY=0 untuk debugging)
    const filtered = items.filter(it => Number(it.liquidity || 0) >= Number(MIN_LIQUIDITY || 0));
    debugLog("Filtered length", { filtered: filtered.length, MIN_LIQUIDITY });

    tokenContainer.innerHTML = '';
    window.tokenMap = {};

    if(filtered.length === 0){
      tokenContainer.innerHTML = `<div class="tiny">No tokens passed filter (count ${items.length}).<br><button id="pwShowRaw" class="btn small">Tampilkan raw JSON di bawah</button></div><pre id="pwFullJson" style="display:none;max-height:300px;overflow:auto;margin-top:10px;background:rgba(0,0,0,0.6);padding:8px;border-radius:8px"></pre>`;
      const btn = document.getElementById('pwShowRaw');
      btn && btn.addEventListener('click', () => {
        const p = document.getElementById('pwFullJson');
        p.style.display = p.style.display === 'none' ? 'block' : 'none';
        p.textContent = JSON.stringify(data, null, 2);
      });
    } else {
      filtered.forEach(it => {
        const addr = it.tokenAddress || it.address || ('addr_' + Math.random().toString(36).slice(2,9));
        window.tokenMap[addr] = it;
        const div = document.createElement('div');
        div.className = 'token';
        div.dataset.addr = addr;
        const liquidity = Number(it.liquidity || 0);
        const fdv = Number(it.fullyDilutedValuation || it.fdv || 0);
        const createdAt = it.createdAt ? new Date(it.createdAt).toLocaleTimeString() : 'â€”';
        div.innerHTML = `
          <div>
            <div><b style="color:var(--neon)">${it.symbol || '?'}</b> â€” ${it.name || 'Unnamed'}</div>
            <div class="tiny">ðŸ’§ $${isFinite(liquidity) ? liquidity.toLocaleString() : 'â€”'} â€¢ ðŸ§® FDV: $${isFinite(fdv) ? fdv.toLocaleString() : 'â€”'}</div>
          </div>
          <div class="tiny">${createdAt}</div>
        `;
        tokenContainer.appendChild(div);
      });
    }

    apiStatusEl.textContent = 'Proxy: OK';
    lastUpdateEl.textContent = new Date().toLocaleTimeString();
  } catch(err){
    console.error(err);
    debugLog("Fetch exception", String(err));
    apiStatusEl.textContent = 'Proxy: error';
    tokenContainer.innerHTML = `<div class="tiny">Network error â€” cek console/depoy logs</div>`;
    lastUpdateEl.textContent = new Date().toLocaleTimeString();
  }
}

// delegated modal click (keamanan: sederhana)
(function setupModalClick(){
  // ensure modal exists (simple)
  let modal = document.querySelector('.pw-modal');
  if(!modal){
    modal = document.createElement('div');
    modal.className = 'pw-modal';
    modal.style.display = 'none';
    modal.innerHTML = `<div class="card" style="color:#dff;padding:14px;max-width:720px"><button class="closeBtn" style="float:right">âœ•</button><div id="modalBody"></div></div>`;
    document.body.appendChild(modal);
    modal.querySelector('.closeBtn').onclick = ()=> modal.style.display = 'none';
  }
  tokenContainer.addEventListener('click', (ev) => {
    const tokenEl = ev.target.closest('.token');
    if(!tokenEl) return;
    const addr = tokenEl.dataset.addr;
    const item = window.tokenMap[addr];
    if(!item) return;
    const mb = modal.querySelector('#modalBody');
    mb.innerHTML = `<h3 style="color:var(--neon)">${item.name || item.token_name || 'Unnamed'} (${item.symbol||'â€”'})</h3><pre style="max-height:220px;overflow:auto">${JSON.stringify(item,null,2)}</pre>`;
    modal.style.display = 'flex';
  });
})();

// controls & polling
const refreshBtn = document.getElementById('refreshBtn');
const pauseBtn = document.getElementById('pauseBtn');
let paused = false;
let pollHandle = null;
function startPolling(){ stopPolling(); pollHandle = setInterval(fetchTokens, POLL_INTERVAL); }
function stopPolling(){ if(pollHandle) clearInterval(pollHandle); pollHandle = null; }

refreshBtn && refreshBtn.addEventListener('click', fetchTokens);
pauseBtn && pauseBtn.addEventListener('click', () => {
  paused = !paused;
  pauseBtn.textContent = paused ? 'Resume' : 'Pause';
  if(!paused) startPolling(); else stopPolling();
});

// run first time
fetchTokens();
startPolling();
</script>  

</body>
</html>
