<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PumpWolf Dashboard ‚Äî Cyber Meme Utility</title>

  <meta name="description" content="PumpWolf Dashboard ‚Äî Cyber Meme Utility tracking clean Solana gems in real time." />
  <meta property="og:title" content="üê∫ PumpWolf Dashboard ‚Äî Live Token Feed" />
  <meta property="og:description" content="Cyber Meme Utility for Solana Gem Hunters. Track clean tokens, live data, and community howls." />
  <meta property="og:image" content="https://raw.githubusercontent.com/3disutisna-afk/pumpwolf/main/assets/pumpwolf_banner.jpg" />
  <meta property="og:url" content="https://3disutisna-afk.github.io/pumpwolf/" />
  <meta name="twitter:card" content="summary_large_image" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script> <!-- Versi spesifik untuk stabilitas -->

  <style>
    :root {
      --bg: #030406; --card: #071018; --neon: #00f0ff; --accent: #8a2be2; --muted: #9bb;
    }
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body { font-family: Inter, system-ui, sans-serif; background: radial-gradient(circle at 10% 10%, #02030a 0%, var(--bg) 60%); color: #dff }
    header { padding: 18px 16px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(0,255,255,0.05) }
    header .logo { width: 52px; height: 52px; border-radius: 10px; object-fit: contain; box-shadow: 0 0 18px rgba(0,240,255,0.1) }
    header h1 { margin: 0; font-size: 1.05rem; color: var(--neon) } .muted { color: var(--muted); font-size: 0.9rem }
    .layout { display: flex; gap: 16px; padding: 16px; align-items: flex-start }
    .col-left { width: 280px; min-width: 240px } .col-main { flex: 1 }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015)); border: 1px solid rgba(0,240,255,0.06); border-radius: 12px; padding: 14px; margin-bottom: 14px; box-shadow: 0 6px 24px rgba(0,0,0,0.45) }
    .btn { background: linear-gradient(90deg, var(--neon), var(--accent)); border: none; color: #001; padding: 8px 12px; border-radius: 10px; font-weight: 700; cursor: pointer; text-decoration: none; display: inline-block }
    .small { padding: 6px 10px; font-size: 0.85rem } .tiny { font-size: 0.82rem; color: var(--muted) }
    .token-list { display: flex; flex-direction: column; gap: 10px; max-height: 65vh; overflow: auto; padding-right: 6px }
    .token { display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 10px; border-radius: 10px; background: linear-gradient(90deg, rgba(0,0,0,0.16), rgba(0,0,0,0.06)); border: 1px solid rgba(0,240,255,0.03); transition: transform .18s ease, box-shadow .18s ease }
    .token:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,240,255,0.06) }
    footer { text-align: center; padding: 14px 20px; color: var(--muted); font-size: 0.85rem }
    .howl-bar { height: 10px; border-radius: 8px; background: rgba(255,255,255,0.03); overflow: hidden; margin-top: 8px; box-shadow: inset 0 0 6px rgba(0,240,255,0.08) }
    @keyframes howlGrow { 0% { width: 40% } 100% { width: 90% } }
    @media (max-width: 900px) { .layout { flex-direction: column; padding: 12px } .col-left { width: 100% } .col-main { width: 100% } }
    @media (max-width: 500px) { header .logo { width: 46px; height: 46px } header h1 { font-size: 1rem } .card { padding: 10px } }
    .pw-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(6px) saturate(120%) }
    .pw-modal.open { display: flex }

    .pw-fallback {
      display: none;
      position: fixed;
      inset: 12px 12px auto 12px;
      z-index: 99999;
      background: linear-gradient(90deg, rgba(6,8,16,0.98), rgba(3,5,12,0.98));
      color: #dff;
      border: 1px solid rgba(0,240,255,0.08);
      padding: 12px 14px;
      border-radius: 12px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.6);
      max-width: calc(100% - 40px);
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      font-family: Inter, system-ui, sans-serif;
    }
    .pw-fallback .left { display: flex; gap: 10px; align-items: center; max-width: 70%; }
    .pw-fallback .left .dot { width: 12px; height: 12px; border-radius: 50%; background: #ff6b6b; box-shadow: 0 0 12px rgba(255,107,107,0.12); }
    .pw-fallback .title { font-weight: 700; color: var(--neon); font-size: 0.98rem }
    .pw-fallback .desc { font-size: 0.9rem; color: var(--muted); margin-top: 4px }
    .pw-fallback .actions { display: flex; gap: 8px; align-items: center }
    .pw-fallback .btn { background: linear-gradient(90deg, var(--neon), var(--accent)); color: #001; padding: 8px 10px; border-radius: 10px; font-weight: 700; text-decoration: none; border: none; cursor: pointer; }
    .pw-fallback .btn.secondary { background: transparent; border: 1px solid rgba(255,255,255,0.03); color: var(--muted); padding: 8px 10px; }
    .pw-fallback .count { color: var(--muted); font-size: 0.9rem; margin-left: 6px }
    @media (max-width: 720px) {
      .pw-fallback { flex-direction: column; align-items: flex-start; gap: 8px; left: 12px; right: 12px; }
      .pw-fallback .left { max-width: 100%; }
      .pw-fallback .actions { width: 100%; justify-content: space-between; }
    }

    .debug { display: none; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size: 13px; color: #c8fff6; white-space: pre-wrap; overflow: auto; max-height: 220px; padding: 12px; background: rgba(0,0,0,0.22); border-radius: 8px; border: 1px solid rgba(0,240,255,0.03) }
    .debug.visible { display: block }

    .mini-chart {
      width: 100%;
      height: 100px;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <div id="pwFallback" class="pw-fallback" role="alert" aria-live="polite">
    <div class="left">
      <div class="dot" aria-hidden="true"></div>
      <div>
        <div class="title">Mode statis: fitur server tidak aktif di GitHub Pages</div>
        <div class="desc">Proxy/API backend tidak tersedia di versi statis. Untuk experience penuh (live data & fungsi), buka versi lengkap.</div>
      </div>
    </div>
    <div class="actions">
      <a id="openVercel" class="btn" href="https://pumpwolf.vercel.app/" target="_blank" rel="noopener">Buka versi penuh</a>
      <button id="stayBtn" class="btn secondary" type="button">Tetap di sini</button>
      <div style="display: flex; align-items: center"><span class="count" id="redirectCountdown">‚Ü™ otomatis pindah dalam 8s</span></div>
    </div>
  </div>

  <header>
    <img class="logo" src="https://raw.githubusercontent.com/3disutisna-afk/pumpwolf/main/assets/wolf_logo.png" alt="PumpWolf Logo" onerror="this.src='https://via.placeholder.com/52?text=No+Logo';this.onerror=null;" />
    <div>
      <h1>PumpWolf Dashboard</h1>
      <div class="muted">Cyber Meme Utility ‚Äî Wolf Pack Live üê∫</div>
    </div>
  </header>

  <div class="layout">
    <aside class="col-left">
      <div class="card">
        <div class="muted">API Status</div>
        <div id="api-status" style="color: var(--neon); margin-top: 6px">Proxy: ready</div>
        <div class="muted" style="margin-top: 8px">Last update: <span id="last-update">‚Äî</span></div>
      </div>

      <div class="card">
        <div class="muted">Controls</div>
        <div style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap">
          <button class="btn small" id="refreshBtn">Refresh</button>
          <button class="btn small" id="pauseBtn">Pause</button>
        </div>
      </div>

      <div class="card">
        <div class="muted">Debug panel (fetch status & headers)</div>
        <div id="debugPanel" class="debug">[debug output appears here]</div>
      </div>
    </aside>

    <main class="col-main">
      <div class="card" id="featuredToken">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap">
          <div>
            <div class="muted" style="font-size: 0.9rem">üî• Featured Token</div>
            <h2 style="color: var(--neon); margin: 6px 0" id="featuredTitle">$WOLF ‚Äî The Cyber Meme Wolf</h2>
            <div class="tiny" id="wolfData">Loading live data...</div>
          </div>
          <img id="featuredLogo" src="https://raw.githubusercontent.com/3disutisna-afk/pumpwolf/main/assets/wolf_logo.png" alt="$WOLF" style="width: 60px; height: 60px; border-radius: 12px; box-shadow: 0 0 18px rgba(0,240,255,0.25); margin-top: 6px" onerror="this.src='https://via.placeholder.com/60?text=No+Logo';this.onerror=null;" />
        </div>
        <div class="howl-bar" style="margin-top: 10px"><div class="fill" id="howlFill" style="width: 50%"></div></div>
        <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap">
          <a id="btnBuy" class="btn small" href="#" target="_blank">üíß Buy on Pump.fun</a>
          <a id="btnSolscan" class="btn small" href="#" target="_blank">üîé Solscan</a>
        </div>
      </div>

      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap">
          <div><b style="color: var(--neon)">Live Tokens</b> <span class="muted">‚Äî auto-updated from Moralis (via proxy)</span></div>
          <div class="muted" style="font-size: 0.85rem">Refresh: <span id="interval-label">60s</span></div>
        </div>
        <div id="tokenContainer" class="token-list">
          <div class="tiny">Loading...</div>
        </div>
      </div>
    </main>
  </div>

  <footer>¬© 2025 PumpWolf ‚Äî The Cyber Pack ‚Ä¢ v2.2</footer>

  <script>
    (function() {
      const VERCEL_BASE = "https://pumpwolf.vercel.app";
      const ENDPOINT = VERCEL_BASE + "/api/proxy/token/mainnet/exchange/pumpfun/new?limit=20";
      const FEATURE_PRICE_URL = (addr) => VERCEL_BASE + `/api/proxy/token/mainnet/${addr}/price`;
      const FEATURED_TOKEN_ADDRESS = "";
      const POLL_INTERVAL = 60000;
      const MIN_LIQUIDITY = 5000;

      const apiStatusEl = document.getElementById('api-status');
      const lastUpdateEl = document.getElementById('last-update');
      const tokenContainer = document.getElementById('tokenContainer');
      const debugPanel = document.getElementById('debugPanel');
      const refreshBtn = document.getElementById('refreshBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const wolfData = document.getElementById('wolfData');
      const btnBuy = document.getElementById('btnBuy');
      const btnSolscan = document.getElementById('btnSolscan');
      window.tokenMap = {};

      function debugLog(...args) {
        try {
          const t = new Date().toLocaleTimeString();
          const s = args.map(a => (typeof a === 'string' ? a : JSON.stringify(a, null, 2))).join(' ');
          debugPanel.textContent = `[${t}] ` + s + "\n\n" + debugPanel.textContent;
          debugPanel.classList.add('visible');
        } catch (e) { console.log(...args); }
      }

      async function fetchTokens() {
        apiStatusEl.textContent = 'Fetching...';
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 15000);
          const res = await fetch(ENDPOINT, { headers: { "accept": "application/json" }, signal: controller.signal });
          clearTimeout(timeoutId);
          if (!res.ok) {
            apiStatusEl.textContent = `Proxy: error ${res.status}`;
            tokenContainer.innerHTML = `<div class="tiny">Moralis proxy returned ${res.status}</div>`;
            debugLog("Fetch failed:", { status: res.status });
            lastUpdateEl.textContent = new Date().toLocaleTimeString();
            return;
          }

          const data = await res.json();
          if (!data || !Array.isArray(data.result)) {
            apiStatusEl.textContent = 'Proxy: malformed JSON';
            tokenContainer.innerHTML = `<div class="tiny">Malformed JSON dari proxy</div>`;
            debugLog("Invalid JSON:", data);
            lastUpdateEl.textContent = new Date().toLocaleTimeString();
            return;
          }

          const filtered = data.result.filter(it => Number(it.liquidity || 0) >= MIN_LIQUIDITY);
          tokenContainer.innerHTML = '';
          window.tokenMap = {};

          if (!filtered.length) {
            tokenContainer.innerHTML = `<div class="tiny">No tokens passed liquidity filter (>= ${MIN_LIQUIDITY})</div>`;
          } else {
            filtered.forEach(it => {
              const addr = it.tokenAddress || it.address || ('addr_' + Math.random().toString(36).slice(2, 9));
              window.tokenMap[addr] = it;
              const div = document.createElement('div');
              div.className = 'token';
              div.dataset.addr = addr;
              const liquidity = Number(it.liquidity || 0);
              const fdv = Number(it.fullyDilutedValuation || it.fdv || 0);
              const createdAt = it.createdAt ? new Date(it.createdAt).toLocaleTimeString() : '‚Äî';
              div.innerHTML = `
                <div>
                  <div><b style="color: var(--neon)">${escapeHtml(it.symbol || '?')}</b> ‚Äî ${escapeHtml(it.name || 'Unnamed')}</div>
                  <div class="tiny">üíß $${isFinite(liquidity) ? Number(liquidity).toLocaleString() : '‚Äî'} ‚Ä¢ üßÆ FDV: $${isFinite(fdv) ? Number(fdv).toLocaleString() : '‚Äî'}</div>
                </div>
                <div class="tiny">${createdAt}</div>
              `;
              tokenContainer.appendChild(div);
            });
          }

          apiStatusEl.textContent = 'Proxy: OK';
          lastUpdateEl.textContent = new Date().toLocaleTimeString();
        } catch (err) {
          console.error(err);
          apiStatusEl.textContent = 'Proxy: error';
          tokenContainer.innerHTML = `<div class="tiny">Network error (timeout?)</div>`;
          debugLog("Fetch error:", err.message);
          lastUpdateEl.textContent = new Date().toLocaleTimeString();
        }
      }

      (function setupModal() {
        const modal = document.createElement('div');
        modal.className = 'pw-modal';
        modal.style.display = 'none';
        modal.innerHTML = `
          <div style="width: min(720px, 94%); max-height: 86vh; overflow: auto; padding: 18px; border-radius: 12px; background: linear-gradient(135deg, rgba(2,6,10,0.96), rgba(6,8,16,0.99)); border: 1px solid rgba(0,240,255,0.06); box-shadow: 0 30px 80px rgba(0,0,0,0.7); color: #dff">
            <button class="closeBtn" style="float: right; background: transparent; border: 0; color: #9fe; font-size: 20px; cursor: pointer">‚úï</button>
            <div style="display: flex; gap: 12px; align-items: center;">
              <img id="mLogo" src="" alt="Token Logo" style="width: 64px; height: 64px; border-radius: 8px; object-fit: cover; box-shadow: 0 0 20px rgba(0,240,255,0.08)" onerror="this.src='https://via.placeholder.com/64?text=No+Logo';this.onerror=null;" />
              <div>
                <h2 id="mName" style="margin: 0; color: var(--neon)"></h2>
                <div id="mSymbol" class="tiny" style="margin-top: 6px"></div>
              </div>
            </div>
            <div id="mDetails" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 12px;"></div>
            <canvas id="miniChart" class="mini-chart"></canvas>
            <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end">
              <a id="mPump" class="btn small" target="_blank" style="text-decoration: none">Open on Pump.fun</a>
              <a id="mSolscan" class="btn small" target="_blank" style="text-decoration: none">Open on Solscan</a>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        modal.querySelector('.closeBtn').onclick = () => modal.style.display = 'none';
        modal.addEventListener('click', (ev) => { if (ev.target === modal) modal.style.display = 'none'; });

        tokenContainer.addEventListener('click', (ev) => {
          const tokenEl = ev.target.closest('.token');
          if (!tokenEl) return;
          const addr = tokenEl.dataset.addr;
          const item = window.tokenMap[addr];
          if (!item) return;

          modal.style.display = 'flex';
          modal.querySelector('#mLogo').src = item.logo || 'https://via.placeholder.com/64?text=No+Logo';
          modal.querySelector('#mName').textContent = item.name || 'Unnamed';
          modal.querySelector('#mSymbol').textContent = (item.symbol || '‚Äî') + ' ‚Ä¢ ' + (addr ? (addr.slice(0, 6) + '...') : '');

          const price = item.priceUsd ? ('$' + Number(item.priceUsd).toFixed(6)) : '‚Äî';
          const liquidity = item.liquidity ? ('$' + Number(item.liquidity).toLocaleString()) : '‚Äî';
          const fdv = item.fullyDilutedValuation ? ('$' + Number(item.fullyDilutedValuation).toLocaleString()) : '‚Äî';
          const created = item.createdAt ? new Date(item.createdAt).toLocaleString() : '‚Äî';
          const holders = 'Loading...';
          modal.querySelector('#mDetails').innerHTML = `
            <div style="background: rgba(255,255,255,0.01); padding: 8px; border-radius: 8px; border: 1px solid rgba(0,240,255,0.03)">
              <div class="tiny">Price (USD)</div><div style="color: var(--neon); font-weight: 700">${price}</div>
            </div>
            <div style="background: rgba(255,255,255,0.01); padding: 8px; border-radius: 8px; border: 1px solid rgba(0,240,255,0.03)">
              <div class="tiny">Liquidity</div><div style="color: var(--neon); font-weight: 700">${liquidity}</div>
            </div>
            <div style="background: rgba(255,255,255,0.01); padding: 8px; border-radius: 8px; border: 1px solid rgba(0,240,255,0.03)">
              <div class="tiny">FDV</div><div style="color: var(--neon); font-weight: 700">${fdv}</div>
            </div>
            <div style="background: rgba(255,255,255,0.01); padding: 8px; border-radius: 8px; border: 1px solid rgba(0,240,255,0.03)">
              <div class="tiny">Created</div><div style="color: var(--neon); font-weight: 700">${created}</div>
            </div>
            <div style="background: rgba(255,255,255,0.01); padding: 8px; border-radius: 8px; border: 1px solid rgba(0,240,255,0.03)">
              <div class="tiny">Holders</div><div style="color: var(--neon); font-weight: 700">${holders}</div>
            </div>
          `;

          const ctx = modal.querySelector('#miniChart').getContext('2d');
          if (!ctx) {
            console.error("Canvas context not found for #miniChart");
            debugLog("Error: Canvas context for miniChart not found");
            return;
          }
          if (typeof Chart === 'undefined') {
            console.error("Chart.js not loaded");
            debugLog("Error: Chart.js library not loaded");
            return;
          }
          let existingChart = Chart.getChart(ctx);
          if (existingChart) existingChart.destroy();
          const basePrice = Number(item.priceUsd) || 0.0001;
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: ['1h', '2h', '3h', '4h', '5h'],
              datasets: [{
                label: 'Price (USD)',
                data: [basePrice, basePrice * 1.1, basePrice * 1.2, basePrice * 1.15, basePrice * 1.3],
                borderColor: 'rgba(0, 240, 255, 0.8)',
                backgroundColor: 'rgba(0, 240, 255, 0.2)',
                fill: true,
                tension: 0.4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: { y: { beginAtZero: true, ticks: { color: '#9bb' } }, x: { ticks: { color: '#9bb' } } }
            }
          });
          debugLog("Mini chart rendered for token:", item.symbol || 'Unknown');

          modal.querySelector('#mPump').href = addr ? `https://pump.fun/coin/${addr}` : '#';
          modal.querySelector('#mSolscan').href = addr ? `https://solscan.io/token/${encodeURIComponent(addr)}?cluster=mainnet` : '#';
        });
      })();

      async function loadFeaturedToken() {
        const addr = FEATURED_TOKEN_ADDRESS || null;
        if (!addr) {
          wolfData.textContent = 'Featured token not set.';
          btnBuy.href = '#';
          btnSolscan.href = '#';
          return;
        }

        btnBuy.href = `https://pump.fun/coin/${addr}`;
        btnSolscan.href = `https://solscan.io/token/${encodeURIComponent(addr)}?cluster=mainnet`;

        try {
          const res = await fetch(FEATURE_PRICE_URL(addr), { headers: { "accept": "application/json" } });
          if (!res.ok) { wolfData.textContent = `No live price (status ${res.status})`; return; }
          const data = await res.json();
          if (data && data.usdPrice) {
            wolfData.innerHTML = `üí∞ Price: <b>$${Number(data.usdPrice).toFixed(6)}</b> ‚Ä¢ ‚è± ${new Date().toLocaleTimeString()}`;
            const liquidity = Number(data.liquidity || 0) || 0;
            const fdv = Number(data.fullyDilutedValuation || 0) || 0;
            const strength = Math.min(95, Math.round(Math.min(100, (liquidity / Math.max(1, fdv)) * 100 * 2)));
            document.getElementById('howlFill').style.width = Math.max(6, strength) + '%';
          } else {
            wolfData.textContent = 'No price data';
          }
        } catch (err) {
          console.error(err);
          wolfData.textContent = 'Error loading featured data';
          debugLog("Featured token load error:", err.message);
        }
      }

      let paused = false;
      let pollHandle = null;
      function startPolling() { stopPolling(); pollHandle = setInterval(fetchTokens, POLL_INTERVAL); }
      function stopPolling() { if (pollHandle) clearInterval(pollHandle); }

      refreshBtn.addEventListener('click', () => {
        if (!paused) fetchTokens();
      });
      pauseBtn.addEventListener('click', () => {
        paused = !paused;
        pauseBtn.textContent = paused ? 'Resume' : 'Pause';
        if (!paused) startPolling(); else stopPolling();
      });

      function escapeHtml(s) { if (!s) return ''; return String(s).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[c]); }

      (async function fallbackProbe() {
        const isStatic = !location.hostname.endsWith('.vercel.app') && location.hostname !== 'pumpwolf.vercel.app';
        if (isStatic) {
          document.getElementById('pwFallback').style.display = 'flex';
          const stayBtn = document.getElementById('stayBtn');
          const countdownEl = document.getElementById('redirectCountdown');
          let count = 8;
          countdownEl.textContent = `‚Ü™ otomatis pindah dalam ${count}s`;
          const timerId = setInterval(() => {
            count--;
            countdownEl.textContent = `‚Ü™ otomatis pindah dalam ${count}s`;
            if (count <= 0) {
              clearInterval(timerId);
              window.location.href = VERCEL_BASE + '/';
            }
          }, 1000);

          stayBtn.addEventListener('click', () => {
            clearInterval(timerId);
            countdownEl.textContent = 'Redirect dibatalkan ‚Äî tetap di halaman ini';
            stayBtn.disabled = true;
            stayBtn.textContent = 'Menetap';
          });
          refreshBtn.disabled = true;
          pauseBtn.disabled = true;
          apiStatusEl.textContent = 'Offline (Static Mode)';
          tokenContainer.innerHTML = `<div class="tiny">Token list unavailable in static mode. Visit <a href="${VERCEL_BASE}/">live version</a>.</div>`;
          wolfData.textContent = 'Data unavailable in static mode. Visit live version for details.';
        } else {
          document.getElementById('pwFallback').style.display = 'none';
          fetchTokens();
          loadFeaturedToken();
          startPolling();
        }
      })();
    })();
  </script>
</body>
</html>
