<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PumpWolf Dashboard ‚Äî Cyber Meme Utility</title>

  <meta name="description" content="PumpWolf Dashboard ‚Äî Cyber Meme Utility tracking clean Solana gems in real time." />
  <meta property="og:title" content="üê∫ PumpWolf Dashboard ‚Äî Live Token Feed" />
  <meta property="og:description" content="Cyber Meme Utility for Solana Gem Hunters. Track clean tokens, live data, and community howls." />
  <meta property="og:image" content="https://raw.githubusercontent.com/3disutisna-afk/pumpwolf/main/assets/pumpwolf_banner.jpg" />
  <meta property="og:url" content="https://3disutisna-afk.github.io/pumpwolf/" />
  <meta name="twitter:card" content="summary_large_image" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --bg: #030406; --card: #071018; --neon: #00f0ff; --accent: #8a2be2; --muted: #9bb;
    }
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body { font-family: Inter, system-ui, sans-serif; background: radial-gradient(circle at 10% 10%, #02030a 0%, var(--bg) 60%); color: #dff }
    header { padding: 18px 16px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(0,255,255,0.05) }
    header .logo { width: 52px; height: 52px; border-radius: 10px; object-fit: contain; box-shadow: 0 0 18px rgba(0,240,255,0.1) }
    header h1 { margin: 0; font-size: 1.05rem; color: var(--neon) } .muted { color: var(--muted); font-size: 0.9rem }
    .layout { display: flex; gap: 16px; padding: 16px; align-items: flex-start }
    .col-left { width: 280px; min-width: 240px } .col-main { flex: 1 }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015)); border: 1px solid rgba(0,240,255,0.06); border-radius: 12px; padding: 14px; margin-bottom: 14px; box-shadow: 0 6px 24px rgba(0,0,0,0.45) }
    .btn { background: linear-gradient(90deg, var(--neon), var(--accent)); border: none; color: #001; padding: 8px 12px; border-radius: 10px; font-weight: 700; cursor: pointer; text-decoration: none; display: inline-block }
    .small { padding: 6px 10px; font-size: 0.85rem } .tiny { font-size: 0.82rem; color: var(--muted) }
    .token-list { display: flex; flex-direction: column; gap: 10px; max-height: 65vh; overflow: auto; padding-right: 6px }
    .token { display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 10px; border-radius: 10px; background: linear-gradient(90deg, rgba(0,0,0,0.16), rgba(0,0,0,0.06)); border: 1px solid rgba(0,240,255,0.03); transition: transform .18s ease, box-shadow .18s ease; cursor: pointer }
    .token:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,240,255,0.06) }
    footer { text-align: center; padding: 14px 20px; color: var(--muted); font-size: 0.85rem }
    .howl-bar { height: 10px; border-radius: 8px; background: rgba(255,255,255,0.03); overflow: hidden; margin-top: 8px; box-shadow: inset 0 0 6px rgba(0,240,255,0.08) }
    @keyframes howlGrow { 0% { width: 40% } 100% { width: 90% } }
    @media (max-width: 900px) { .layout { flex-direction: column; padding: 12px } .col-left { width: 100% } .col-main { width: 100% } }
    @media (max-width: 500px) { header .logo { width: 46px; height: 46px } header h1 { font-size: 1rem } .card { padding: 10px } }
    .pw-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(6px) saturate(120%) }
    .pw-modal.open { display: flex }
    .pw-fallback { display: none; position: fixed; inset: 12px 12px auto 12px; z-index: 99999; background: linear-gradient(90deg, rgba(6,8,16,0.98), rgba(3,5,12,0.98)); color: #dff; border: 1px solid rgba(0,240,255,0.08); padding: 12px 14px; border-radius: 12px; box-shadow: 0 18px 60px rgba(0,0,0,0.6); max-width: calc(100% - 40px); display: flex; gap: 12px; align-items: center; justify-content: space-between; font-family: Inter, system-ui, sans-serif; }
    .pw-fallback .left { display: flex; gap: 10px; align-items: center; max-width: 70%; }
    .pw-fallback .left .dot { width: 12px; height: 12px; border-radius: 50%; background: #ff6b6b; box-shadow: 0 0 12px rgba(255,107,107,0.12); }
    .pw-fallback .title { font-weight: 700; color: var(--neon); font-size: 0.98rem }
    .pw-fallback .desc { font-size: 0.9rem; color: var(--muted); margin-top: 4px }
    .pw-fallback .actions { display: flex; gap: 8px; align-items: center }
    .pw-fallback .btn { background: linear-gradient(90deg, var(--neon), var(--accent)); color: #001; padding: 8px 10px; border-radius: 10px; font-weight: 700; text-decoration: none; border: none; cursor: pointer; }
    .pw-fallback .btn.secondary { background: transparent; border: 1px solid rgba(255,255,255,0.03); color: var(--muted); padding: 8px 10px; }
    .pw-fallback .count { color: var(--muted); font-size: 0.9rem; margin-left: 6px }
    @media (max-width: 720px) { .pw-fallback { flex-direction: column; align-items: flex-start; gap: 8px; left: 12px; right: 12px; } .pw-fallback .left { max-width: 100%; } .pw-fallback .actions { width: 100%; justify-content: space-between; } }
    .debug { display: none; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size: 13px; color: #c8fff6; white-space: pre-wrap; overflow: auto; max-height: 220px; padding: 12px; background: rgba(0,0,0,0.22); border-radius: 8px; border: 1px solid rgba(0,240,255,0.03) }
    .debug.visible { display: block }
    .mini-chart { width: 100%; height: 100px; margin-top: 12px; }
  </style>
</head>
<body>
  <div id="pwFallback" class="pw-fallback">
    <div class="left">
      <div class="dot"></div>
      <div>
        <div class="title">Mode statis: fitur server tidak aktif di GitHub Pages</div>
        <div class="desc">Proxy/API backend tidak tersedia di versi statis. Untuk experience penuh (live data & fungsi), buka versi lengkap.</div>
      </div>
    </div>
    <div class="actions">
      <a id="openVercel" class="btn" href="https://pumpwolf.vercel.app/" target="_blank" rel="noopener">Buka versi penuh</a>
      <button id="stayBtn" class="btn secondary">Tetap di sini</button>
      <div style="display:flex;align-items:center"><span class="count" id="redirectCountdown">‚Ü™ otomatis pindah dalam 8s</span></div>
    </div>
  </div>

  <header>
    <img class="logo" src="https://raw.githubusercontent.com/3disutisna-afk/pumpwolf/main/assets/wolf_logo.png" alt="PW" onerror="this.src='https://via.placeholder.com/52?text=PW'" />
    <div>
      <h1>PumpWolf Dashboard</h1>
      <div class="muted">Cyber Meme Utility ‚Äî Wolf Pack Live üê∫</div>
    </div>
  </header>

  <div class="layout">
    <aside class="col-left">
      <div class="card">
        <div class="muted">API Status</div>
        <div id="api-status" style="color:var(--neon);margin-top:6px">Proxy: ready</div>
        <div class="muted" style="margin-top:8px">Last update: <span id="last-update">‚Äî</span></div>
      </div>

      <div class="card">
        <div class="muted">Controls</div>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small" id="refreshBtn">Refresh</button>
          <button class="btn small" id="pauseBtn">Pause</button>
        </div>
      </div>

      <div class="card">
        <div class="muted">Debug panel (fetch status & headers)</div>
        <div id="debugPanel" class="debug"></div>
      </div>
    </aside>

    <main class="col-main">
      <div class="card" id="featuredToken">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap">
          <div>
            <div class="muted" style="font-size:0.9rem">üî• Featured Token</div>
            <h2 style="color:var(--neon);margin:6px 0" id="featuredTitle">$WOLF ‚Äî The Cyber Meme Wolf</h2>
            <div class="tiny" id="wolfData">Loading live data...</div>
          </div>
          <img id="featuredLogo" src="https://raw.githubusercontent.com/3disutisna-afk/pumpwolf/main/assets/wolf_logo.png" alt="$WOLF" style="width:60px;height:60px;border-radius:12px;box-shadow:0 0 18px rgba(0,240,255,0.25);margin-top:6px" onerror="this.src='https://via.placeholder.com/60?text=W'" />
        </div>

        <div class="howl-bar" style="margin-top:10px"><div class="fill" id="howlFill" style="width:50%"></div></div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <a id="btnBuy" class="btn small" href="#" target="_blank">üíß Buy on Pump.fun</a>
          <a id="btnSolscan" class="btn small" href="#" target="_blank">üîé Solscan</a>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap">
          <div><b style="color:var(--neon)">Live Tokens (Filtered Safe & Potensial)</b> <span class="muted">‚Äî auto-updated from Moralis (via proxy)</span></div>
          <div class="muted" style="font-size:0.85rem">Refresh: <span id="interval-label">60s</span></div>
        </div>

        <div id="tokenContainer" class="token-list">
          <div class="tiny">Loading...</div>
        </div>
      </div>
    </main>
  </div>

  <footer>¬© 2025 PumpWolf ‚Äî The Cyber Pack ‚Ä¢ v2.2</footer>

  <script>
    (function() {
      const VERCEL_BASE = "https://pumpwolf.vercel.app";
      const MORALIS_API_KEY = "YOUR_MORALIS_API_KEY"; // Ganti dengan API key Moralis kakak
      const X_API_KEY = "YOUR_X_API_KEY"; // Ganti dengan API key X kakak (opsional)
      const ENDPOINT = VERCEL_BASE + "/api/proxy/token/mainnet/exchange/pumpfun/new?limit=50";
      const FEATURE_PRICE_URL = (addr) => VERCEL_BASE + `/api/proxy/token/mainnet/${addr}/price`;
      const FEATURED_TOKEN_ADDRESS = "";
      const POLL_INTERVAL = 60000;
      const MIN_LIQUIDITY = 10000;
      const MAX_FDV = 10000;
      const MAX_AGE_MIN = 60;

      const apiStatusEl = document.getElementById('api-status');
      const lastUpdateEl = document.getElementById('last-update');
      const tokenContainer = document.getElementById('tokenContainer');
      const debugPanel = document.getElementById('debugPanel');
      const refreshBtn = document.getElementById('refreshBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const wolfData = document.getElementById('wolfData');
      const btnBuy = document.getElementById('btnBuy');
      const btnSolscan = document.getElementById('btnSolscan');
      window.tokenMap = {};

      function debugLog(...args) {
        if (!debugPanel.classList.contains('visible')) debugPanel.classList.add('visible');
        const t = new Date().toLocaleTimeString();
        const s = args.map(a => (typeof a === 'string' ? a : JSON.stringify(a, null, 2))).join(' ');
        debugPanel.textContent += `[${t}] ${s}\n`;
        debugPanel.scrollTop = debugPanel.scrollHeight;
      }

      async function fetchJson(url, headers = {}) {
        try {
          const res = await fetch(url, { headers });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return await res.json();
        } catch (err) {
          debugLog("Fetch error:", err.message);
          return null;
        }
      }

      async function getPairsData(tokenAddress) {
        const url = `https://solana-gateway.moralis.io/token/mainnet/${tokenAddress}/pairs`;
        const headers = { "X-API-Key": MORALIS_API_KEY };
        const data = await fetchJson(url, headers);
        if (!data || !data.pairs || !data.pairs.length) {
          debugLog(`No active pairs for ${tokenAddress}`);
          return {};
        }
        const activePairs = data.pairs.filter(p => !p.inactivePair);
        if (activePairs.length) {
          const pair = activePairs.reduce((max, p) => (p.liquidityUsd > max.liquidityUsd ? p : max), activePairs[0]);
          debugLog(`Pairs data for ${tokenAddress}:`, pair);
          return {
            priceUsd: parseFloat(pair.usdPrice || 0),
            liquidity: parseFloat(pair.liquidityUsd || 0),
            volume24h: parseFloat(pair.volume24hrUsd || 0),
            name: pair.pair[0]?.tokenName || "Unknown",
            symbol: pair.pair[0]?.tokenSymbol || "UNK"
          };
        }
        debugLog(`No active pairs for ${tokenAddress}`);
        return {};
      }

      async function getDexscreenerData(tokenAddress) {
        const url = `https://api.dexscreener.com/latest/dex/tokens/${tokenAddress}`;
        const data = await fetchJson(url);
        if (!data || !data.pairs || !data.pairs.length) {
          debugLog(`No pairs from DexScreener for ${tokenAddress}`);
          return {};
        }
        const pair = data.pairs[0];
        debugLog(`DexScreener data for ${tokenAddress}:`, pair);
        return {
          priceUsd: parseFloat(pair.priceUsd || 0),
          liquidity: parseFloat(pair.liquidity?.usd || 0),
          fullyDilutedValuation: parseFloat(pair.fdv || 0),
          volume24h: parseFloat(pair.volume?.h24 || 0),
          priceChange: parseFloat(pair.priceChange?.h24 || 0),
          createdAt: pair.pairCreatedAt || Date.now(),
          name: pair.baseToken?.name || "Unknown",
          symbol: pair.baseToken?.symbol || "UNK"
        };
      }

      async function getHoldersData(tokenAddress, ageMin) {
        if (ageMin < 5) {
          debugLog(`Token ${tokenAddress} too new (${ageMin} min), skipping holders`);
          return { count: "N/A", trend_1h: 0 };
        }
        const url = `https://solana-gateway.moralis.io/token/mainnet/holders/${tokenAddress}`;
        const headers = { "X-API-Key": MORALIS_API_KEY };
        let data = await fetchJson(url, headers);
        if (data && data.totalHolders !== undefined) {
          debugLog(`Holders data for ${tokenAddress}:`, data);
          return {
            count: data.totalHolders.toString(),
            trend_1h: parseInt(data.holderChange?.["1h"]?.change || 0)
          };
        }
        const statsUrl = `https://solana-gateway.moralis.io/token/mainnet/${tokenAddress}/stats`;
        data = await fetchJson(statsUrl, headers);
        if (data && data.holders !== undefined) {
          debugLog(`Stats holders for ${tokenAddress}:`, data);
          return { count: data.holders.toString(), trend_1h: 0 };
        }
        debugLog(`Failed to get holders for ${tokenAddress}`);
        if (ageMin < 30) {
          debugLog(`Using fallback holders=30 for ${tokenAddress} (age ${ageMin} min)`);
          return { count: "30", trend_1h: 0 };
        }
        return { count: "N/A", trend_1h: 0 };
      }

      async function getXHype(tokenName) {
        if (!X_API_KEY || X_API_KEY === "YOUR_X_API_KEY") return 0;
        const url = `https://api.x.com/2/tweets/counts/recent?query=${encodeURIComponent(tokenName)}`;
        const headers = { "Authorization": `Bearer ${X_API_KEY}` };
        const data = await fetchJson(url, headers);
        return data?.meta?.total_tweet_count || 0;
      }

      async function fetchTokenDetails(tokenAddress, ageMin) {
        const [pairsData, dexscreenerData, holdersData] = await Promise.all([
          getPairsData(tokenAddress),
          getDexscreenerData(tokenAddress),
          getHoldersData(tokenAddress, ageMin)
        ]);
        const xHype = await getXHype(pairsData.name || dexscreenerData.name || "Unknown");
        return {
          ...pairsData,
          ...dexscreenerData,
          ...holdersData,
          xHype,
          createdAt: dexscreenerData.createdAt || pairsData.createdAt || Date.now()
        };
      }

      const dummyTokens = [
        { tokenAddress: "8u6hFr2SPrX5GxDdG4wH8kEZfaHSPoULHh3AEFvspump", name: "1 meme, 1 hour, 1 million", symbol: "1", priceUsd: "0.000006892", liquidity: "12971.933460626", fullyDilutedValuation: "6892", createdAt: "2025-10-21T06:35:08.000Z" },
        { tokenAddress: "FhiPLfoZJkDmu7whn6Yoovdh3SR7iaAXbgyU2aSApump", name: "CEO OF HALLOWEEN", symbol: "HALCEO", priceUsd: "0.000005837", liquidity: "11937.123185542", fullyDilutedValuation: "5837", createdAt: "2025-10-21T06:35:07.000Z" },
      ];

      function filterSafeTokens(tokens) {
        const now = new Date();
        return tokens.filter(it => {
          const liq = Number(it.liquidity || 0);
          const fdv = Number(it.fullyDilutedValuation || 0);
          const ageMin = (now - new Date(it.createdAt)) / (1000 * 60);
          return liq >= MIN_LIQUIDITY && fdv <= MAX_FDV && ageMin <= MAX_AGE_MIN;
        }).slice(0, 10);
      }

      async function fetchTokens(retry = 3) {
        if (retry === 0) {
          debugLog("API failed, using dummy data");
          renderTokens(dummyTokens);
          return;
        }
        apiStatusEl.textContent = 'Fetching... (retry ' + (4 - retry) + ')';
        try {
          const res = await fetch(ENDPOINT, { headers: { "accept": "application/json" } });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          if (!data.result) throw new Error('Invalid data');
          const filtered = filterSafeTokens(data.result);
          const detailedTokens = await Promise.all(filtered.map(async it => {
            const details = await fetchTokenDetails(it.tokenAddress, (new Date() - new Date(it.createdAt)) / (1000 * 60));
            return { ...it, ...details };
          }));
          renderTokens(detailedTokens);
          apiStatusEl.textContent = 'Proxy: OK';
        } catch (err) {
          debugLog("Fetch failed:", err.message);
          setTimeout(() => fetchTokens(retry - 1), 2000);
        }
      }

      function renderTokens(tokens) {
        tokenContainer.innerHTML = '';
        window.tokenMap = {};
        if (!tokens.length) {
          tokenContainer.innerHTML = `<div class="tiny">No safe tokens found</div>`;
        } else {
          tokens.forEach(it => {
            const addr = it.tokenAddress;
            window.tokenMap[addr] = it;
            const div = document.createElement('div');
            div.className = 'token';
            div.dataset.addr = addr;
            const liquidity = Number(it.liquidity || 0);
            const fdv = Number(it.fullyDilutedValuation || 0);
            const createdAt = new Date(it.createdAt).toLocaleTimeString();
            div.innerHTML = `
              <div>
                <div><b style="color:var(--neon)">${escapeHtml(it.symbol || '?')}</b> ‚Äî ${escapeHtml(it.name || 'Unnamed')}</div>
                <div class="tiny">üíß $${liquidity.toLocaleString()} ‚Ä¢ üßÆ FDV: $${fdv.toLocaleString()}</div>
              </div>
              <div class="tiny">${createdAt}</div>
            `;
            tokenContainer.appendChild(div);
          });
        }
        lastUpdateEl.textContent = new Date().toLocaleTimeString();
        debugLog(`Rendered ${tokens.length} safe tokens`);
      }

      function setupModal() {
        const modal = document.createElement('div');
        modal.className = 'pw-modal';
        modal.innerHTML = `
          <div style="width:min(720px,94%);max-height:86vh;overflow:auto;padding:18px;border-radius:12px;background:linear-gradient(135deg,rgba(2,6,10,0.96),rgba(6,8,16,0.99));border:1px solid rgba(0,240,255,0.06);box-shadow:0 30px 80px rgba(0,0,0,0.7);color:#dff">
            <button class="closeBtn" style="float:right;background:transparent;border:0;color:#9fe;font-size:20px;cursor:pointer">‚úï</button>
            <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
              <img id="mLogo" src="" alt="Logo" style="width:64px;height:64px;border-radius:8px;object-fit:cover;box-shadow:0 0 20px rgba(0,240,255,0.08)" />
              <div>
                <h2 id="mName" style="margin:0;color:var(--neon)"></h2>
                <div id="mSymbol" style="margin-top:6px;color:var(--muted)">‚õìÔ∏è Solana</div>
              </div>
            </div>
            <div id="mDetails" style="display:flex;flex-direction:column;gap:8px;margin-bottom:12px"></div>
            <canvas id="miniChart" class="mini-chart"></canvas>
            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
              <a id="mPump" class="btn small" target="_blank">Open on Pump.fun</a>
              <a id="mSolscan" class="btn small" target="_blank">Open on Solscan</a>
            </div>
          </div>
        `;
        document.body.appendChild(modal);

        tokenContainer.addEventListener('click', async (ev) => {
          const tokenEl = ev.target.closest('.token');
          if (!tokenEl) {
            debugLog('Click outside token element');
            return;
          }
          debugLog('Token clicked:', tokenEl.dataset.addr);
          const addr = tokenEl.dataset.addr;
          const item = window.tokenMap[addr];
          if (!item) {
            debugLog('No token data for address:', addr);
            return;
          }

          modal.classList.add('open');
          modal.querySelector('#mLogo').src = item.logo || 'https://via.placeholder.com/64?text=?';
          modal.querySelector('#mName').textContent = item.name || 'Unnamed';
          modal.querySelector('#mSymbol').textContent = (item.symbol || '?') + ' ‚Ä¢ ' + (addr ? (addr.slice(0, 6) + '...') : '');

          const ageMin = (new Date() - new Date(item.createdAt)) / (1000 * 60);
          const details = await fetchTokenDetails(addr, ageMin);
          const liqFdv = item.liquidity && item.fullyDilutedValuation ? ((Number(item.liquidity) / Number(item.fullyDilutedValuation)) * 100).toFixed(2) + '%' : '‚Äî';

          modal.querySelector('#mDetails').innerHTML = `
            <div class="tiny">üìä FDV: $${(details.fullyDilutedValuation || item.fullyDilutedValuation || '‚Äî').toLocaleString()}</div>
            <div class="tiny">üíß Liquidity: $${(details.liquidity || item.liquidity || '‚Äî').toLocaleString()}</div>
            <div class="tiny">üìà Liq/FDV: ${liqFdv}</div>
            <div class="tiny">üí∏ Price: $${(details.priceUsd || item.priceUsd || '‚Äî').toFixed(6)}</div>
            <div class="tiny">üìà Price Change (24h): ${details.priceChange !== undefined ? `${details.priceChange.toFixed(2)}%` : 'N/A'}</div>
            <div class="tiny">‚è≥ Age: ${Math.round(ageMin)} min</div>
            <div class="tiny">üë• Holders: ${details.count || 'N/A'}</div>
            <div class="tiny">üìà Holder Trend (1h): ${details.trend_1h !== undefined ? `${details.trend_1h} users` : 'N/A'}</div>
            <div class="tiny">üìä Volume 24h: $${(details.volume24h || 'N/A').toLocaleString()}</div>
            <div class="tiny">üì£ X Hype: ${details.xHype || 'N/A'} mentions</div>
            <div class="tiny">üìç Address: ${addr}</div>
          `;

          const ctx = modal.querySelector('#miniChart').getContext('2d');
          if (ctx && typeof Chart !== 'undefined') {
            let existingChart = Chart.getChart(ctx);
            if (existingChart) existingChart.destroy();
            const basePrice = Number(details.priceUsd || item.priceUsd) || 0.0001;
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: ['1h', '2h', '3h', '4h', '5h'],
                datasets: [{
                  label: 'Price (USD)',
                  data: [basePrice, basePrice * (1 + (details.priceChange || 0) / 100 * 1), basePrice * (1 + (details.priceChange || 0) / 100 * 2), basePrice * (1 + (details.priceChange || 0) / 100 * 3), basePrice * (1 + (details.priceChange || 0) / 100 * 4)],
                  borderColor: 'rgba(0, 240, 255, 0.8)',
                  backgroundColor: 'rgba(0, 240, 255, 0.2)',
                  fill: true,
                  tension: 0.4
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, ticks: { color: '#9bb' } }, x: { ticks: { color: '#9bb' } } }
              }
            });
          }

          modal.querySelector('#mPump').href = addr ? `https://pump.fun/${addr}` : '#';
          modal.querySelector('#mSolscan').href = addr ? `https://solscan.io/token/${addr}` : '#';

          modal.querySelector('.closeBtn').onclick = () => modal.classList.remove('open');
          modal.addEventListener('click', (ev) => { if (ev.target === modal) modal.classList.remove('open'); });
        });
      }

      let paused = false;
      let pollHandle = null;
      function startPolling() { stopPolling(); pollHandle = setInterval(() => { if (!paused) fetchTokens(); }, POLL_INTERVAL); }
      function stopPolling() { if (pollHandle) clearInterval(pollHandle); pollHandle = null; }

      refreshBtn.addEventListener('click', () => { if (!paused) fetchTokens(); });
      pauseBtn.addEventListener('click', () => {
        paused = !paused;
        pauseBtn.textContent = paused ? 'Resume' : 'Pause';
        if (!paused) startPolling(); else stopPolling();
      });

      function escapeHtml(s) { if (!s) return ''; return String(s).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[c]); }

      async function fallbackProbe() {
        const fallback = document.getElementById('pwFallback');
        const isVercel = location.hostname.includes('vercel.app');
        if (isVercel) {
          try {
            const testRes = await fetch(ENDPOINT.replace('limit=50', 'limit=1'), { headers: { "accept": "application/json" } });
            if (testRes.ok) {
              fallback.style.display = 'none';
              fetchTokens();
              startPolling();
              setupModal();
              return;
            }
          } catch (e) {
            debugLog('API test failed, fallback active');
          }
        }
        fallback.style.display = 'flex';
        const stayBtn = document.getElementById('stayBtn');
        const countdownEl = document.getElementById('redirectCountdown');
        let count = 8;
        countdownEl.textContent = `‚Ü™ otomatis pindah dalam ${count}s`;
        const timerId = setInterval(() => {
          count--;
          countdownEl.textContent = `‚Ü™ otomatis pindah dalam ${count}s`;
          if (count <= 0) {
            clearInterval(timerId);
            window.location.href = 'https://pumpwolf.vercel.app/';
          }
        }, 1000);
        stayBtn.addEventListener('click', () => {
          clearInterval(timerId);
          countdownEl.textContent = 'Redirect dibatalkan';
          stayBtn.disabled = true;
          stayBtn.textContent = 'Menetap';
        });
        refreshBtn.disabled = true;
        pauseBtn.disabled = true;
        apiStatusEl.textContent = 'Offline (Static Mode)';
        tokenContainer.innerHTML = `<div class="tiny">Wait for live version</div>`;
      }

      fallbackProbe();
    })();
  </script>
</body>
</html>
